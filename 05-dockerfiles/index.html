















<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2021-10-17 17:53:54 +0000">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/syntax.css" />
    <link rel="license" href="#license-info" />

    



    <!-- Favicons for everyone -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../assets/favicons/swc/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/favicons/swc/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/favicons/swc/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/favicons/swc/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../assets/favicons/swc/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../assets/favicons/swc/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../assets/favicons/swc/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../assets/favicons/swc/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="Software Carpentry - Introduction to Docker"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="../assets/favicons/swc/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="../assets/favicons/swc/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="../assets/favicons/swc/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="../assets/favicons/swc/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="../assets/favicons/swc/mstile-310x310.png" />


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

  <title>
  Writing Dockerfiles and Building Images &ndash; Introduction to Docker
  </title>  

  </head>
  <body>

    


<div class="panel panel-default life-cycle">
  <div id="life-cycle" class="panel-body beta">
    This lesson is being piloted (Beta version)
  </div>
</div>




    <div class="container">
      
















  
  










<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      
      <a href="https://software-carpentry.org" class="pull-left">
        <img class="navbar-logo" src="../assets/img/swc-icon-blue.svg" alt="Software Carpentry logo" />
      </a>
      

      
      <a class="navbar-brand" href="../index.html">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        <li><a href="../CODE_OF_CONDUCT.html">Code of Conduct</a></li>

        
	
        <li><a href="../setup.html">Setup</a></li>

        
        
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            
            <li><a href="../01-introduction/index.html">Introduction</a></li>
            
            
            <li><a href="../02-pulling-images/index.html">Pulling Images</a></li>
            
            
            <li><a href="../03-running-containers/index.html">Running Containers</a></li>
            
            
            <li><a href="../04-file-io/index.html">File I/O with Containers</a></li>
            
            
            <li><a href="../05-dockerfiles/index.html">Writing Dockerfiles and Building Images</a></li>
            
            
            <li><a href="../06-removal/index.html">Removal of Containers and Images</a></li>
            
            
            <li><a href="../07-coffee-break/index.html">Coffee break</a></li>
            
            
            <li><a href="../08-entry/index.html">Using CMD and ENTRYPOINT in Dockerfiles</a></li>
            
            
            <li><a href="../09-build-with-ci/index.html">Build Docker Images with GitLab CI</a></li>
            
            
            <li><a href="../10-challenge-examples/index.html">Challenge Examples</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="../aio/index.html">All in one page (Beta)</a></li>
          </ul>
        </li>
        
	

	
	
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../reference.html">Reference</a></li>
            
            
            <li><a href="../discuss/index.html">Discussion</a></li>
            
            
            <li><a href="../guide/index.html">Instructor Notes</a></li>
            
          </ul>
        </li>
	

	
        <li><a href="../LICENSE.html">License</a></li>
	
	<li><a href="/edit//_episodes/05-dockerfiles.md" data-checker-ignore>Improve this page <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a></li>
	
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>




























  
  











<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../04-file-io/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
    <h3 class="maintitle"><a href="../">Introduction to Docker</a></h3>
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../06-removal/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>

<article>
<div class="row">
  <div class="col-md-1">
  </div>
  <div class="col-md-10">
    <h1 class="maintitle">Writing Dockerfiles and Building Images</h1>
  </div>
  <div class="col-md-1">
  </div>
</div>












<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 20 min
      <br/>
      <strong>Exercises:</strong> 10 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How are Dockerfiles written?</p>
</li>
	
	<li><p>How are Docker images built?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Write simple Dockerfiles</p>
</li>
	
	<li><p>Build a Docker image from a Dockerfile</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<p>Docker images are built through the Docker engine by reading the instructions from a
<a href="https://docs.docker.com/engine/reference/builder/"><code class="language-plaintext highlighter-rouge">Dockerfile</code></a>.
These text based documents provide the instructions though an API similar to the Linux
operating system commands to execute commands during the build.
The <a href="https://github.com/matthewfeickert/Intro-to-Docker/blob/master/Dockerfile"><code class="language-plaintext highlighter-rouge">Dockerfile</code> for the example image</a> being used is an example of
some simple extensions of the <a href="https://hub.docker.com/_/python">official Python 3.9 Docker image</a>
based on the Debian Bullseye OS (<code class="language-plaintext highlighter-rouge">python:3.9-bullseye</code>).</p>

<p>As a very simple of extending the example image into a new image create a <code class="language-plaintext highlighter-rouge">Dockerfile</code>
on your local machine</p>

<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code>touch Dockerfile
</code></pre></div></div>

<p>and then write in it the Docker engine instructions to add <a href="https://packages.debian.org/jessie/cowsay"><code class="language-plaintext highlighter-rouge">cowsay</code></a> and
<a href="https://scikit-learn.org"><code class="language-plaintext highlighter-rouge">scikit-learn</code></a> to the environment</p>

<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Dockerfile
FROM matthewfeickert/intro-to-docker:latest

USER root

RUN apt-get -qq -y update &amp;&amp; \
    apt-get -qq -y upgrade &amp;&amp; \
    apt-get -qq -y install cowsay &amp;&amp; \
    apt-get -y autoclean &amp;&amp; \
    apt-get -y autoremove &amp;&amp; \
    rm -rf /var/lib/apt/lists/* &amp;&amp; \
    ln -s /usr/games/cowsay /usr/bin/cowsay

RUN python -m pip install --no-cache-dir --quiet scikit-learn

USER docker
</code></pre></div></div>

<blockquote class="callout">
  <h2 id="dockerfile-layers">Dockerfile layers</h2>

  <p>Each <code class="language-plaintext highlighter-rouge">RUN</code> command in a Dockerfile creates a new layer to the Docker image.
In general, each layer should try to do one job and the fewer layers in an image
the easier it is compress. When trying to upload and download images on demand the
smaller the size the better.</p>
</blockquote>

<blockquote class="callout">
  <h2 id="dont-run-as-root">Don’t run as <code class="language-plaintext highlighter-rouge">root</code></h2>

  <p>By default Docker containers will run as <code class="language-plaintext highlighter-rouge">root</code>. This is a bad idea and a security concern.
Instead, setup a default user (like <code class="language-plaintext highlighter-rouge">docker</code> in the example) and if needed give the user
greater privileges.</p>
</blockquote>

<p>Then <a href="https://docs.docker.com/engine/reference/commandline/build/"><code class="language-plaintext highlighter-rouge">build</code></a> an image from the <code class="language-plaintext highlighter-rouge">Dockerfile</code> and tag it with a human
readable name</p>

<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build . -f Dockerfile -t extend-example:latest
</code></pre></div></div>

<p>You can now run the image as a container and verify for yourself that your additions exist</p>

<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run --rm -ti extend-example:latest /bin/bash
which cowsay
cowsay "Hello from Docker"
pip list | grep scikit
python -c 'import sklearn as sk; print(sk)'
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/usr/bin/cowsay
 ___________________
&lt; Hello from Docker &gt;
 -------------------
        \   ^__^
         \  (oo)\_______
            (__)\       )\/\
                ||----w |
                ||     ||

scikit-learn        1.0
&lt;module 'sklearn' from '/usr/local/lib/python3.9/site-packages/sklearn/__init__.py'&gt;
</code></pre></div></div>

<blockquote class="callout">
  <h2 id="build-context-matters">Build context matters!</h2>

  <p>In the <code class="language-plaintext highlighter-rouge">docker build</code> command the first argument we passed, <code class="language-plaintext highlighter-rouge">.</code>, was the “build context”.
The build context is the set of files that Docker <code class="language-plaintext highlighter-rouge">build</code> is aware of when it starts the build.
The <code class="language-plaintext highlighter-rouge">.</code> meant that the build context was set to the contents of the current working directory.
Importantly, the <em>entire</em> build context is sent to the Docker daemon at build which means that
<strong>any</strong> and <strong>all files</strong> in the build context will be copied and sent.
Given this, you want to make sure that your build context doesn’t contain any
unnecessary large files, or use a <code class="language-plaintext highlighter-rouge">.dockerignore</code> file to hide them.</p>
</blockquote>

<h1 id="beyond-the-basics">Beyond the basics</h1>

<h2 id="args-and-envs"><code class="language-plaintext highlighter-rouge">ARG</code>s and <code class="language-plaintext highlighter-rouge">ENV</code>s</h2>

<p>Even though the Dockerfile is a set of specific build instructions to the Docker engine it
can still be scripted to give greater flexibility by using the Dockerfile
<a href="https://docs.docker.com/engine/reference/builder/#arg"><code class="language-plaintext highlighter-rouge">ARG</code></a> instruction and the <a href="https://docs.docker.com/engine/reference/commandline/build/#set-build-time-variables---build-arg"><code class="language-plaintext highlighter-rouge">build-arg</code></a> flag to
define build time variables to be evaluated. For example, consider an example Dockerfile
with a configurable <a href="https://docs.docker.com/engine/reference/builder/#from"><code class="language-plaintext highlighter-rouge">FROM</code></a> image</p>

<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Dockerfile.arg-py3
# Make the base image configurable
ARG BASE_IMAGE=python:3.9-bullseye
FROM ${BASE_IMAGE}

USER root

RUN apt-get -qq -y update &amp;&amp; \
    apt-get -qq -y upgrade &amp;&amp; \
    apt-get -y autoclean &amp;&amp; \
    apt-get -y autoremove &amp;&amp; \
    rm -rf /var/lib/apt/lists/*

RUN python -m pip --no-cache-dir install --upgrade pip setuptools wheel &amp;&amp; \
    python -m pip --no-cache-dir install --quiet scikit-learn

# Create user "docker"
RUN useradd -m docker &amp;&amp; \
    cp /root/.bashrc /home/docker/ &amp;&amp; \
    mkdir /home/docker/data &amp;&amp; \
    chown -R --from=root docker /home/docker

WORKDIR /home/docker/data
USER docker
</code></pre></div></div>

<p>and then build it using the <code class="language-plaintext highlighter-rouge">python:3.8</code> image as the <code class="language-plaintext highlighter-rouge">FROM</code> image</p>

<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build -f Dockerfile.arg-py3 --build-arg BASE_IMAGE=python:3.8 -t arg-example:py-38 .
</code></pre></div></div>

<p>which you can check has Python 3.8 and not Python 3.9</p>

<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run --rm -ti arg-example:py-38 /bin/bash
which python
python --version
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/usr/local/bin/python3

Python 3.8.11
</code></pre></div></div>

<blockquote class="callout">
  <h2 id="default-arg-values">Default <code class="language-plaintext highlighter-rouge">ARG</code> values</h2>

  <p>Setting the value of the <code class="language-plaintext highlighter-rouge">ARG</code> inside of the Dockerfile allows for default values to be
used if no <code class="language-plaintext highlighter-rouge">--build-arg</code> is passed to <code class="language-plaintext highlighter-rouge">docker build</code>.</p>
</blockquote>

<p><a href="https://docs.docker.com/engine/reference/builder/#env"><code class="language-plaintext highlighter-rouge">ENV</code></a> variables are similar to <code class="language-plaintext highlighter-rouge">ARG</code> variables, except that they persist
past the build stage and still accessible in the container runtime.
Think of using <code class="language-plaintext highlighter-rouge">ENV</code> in a similar manner to how you would use <code class="language-plaintext highlighter-rouge">export</code> in Bash.</p>

<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Dockerfile.arg-py3
# Make the base image configurable
ARG BASE_IMAGE=python:3.9-bullseye
FROM ${BASE_IMAGE}

USER root

RUN apt-get -qq -y update &amp;&amp; \
    apt-get -qq -y upgrade &amp;&amp; \
    apt-get -y autoclean &amp;&amp; \
    apt-get -y autoremove &amp;&amp; \
    rm -rf /var/lib/apt/lists/*

RUN python -m pip --no-cache-dir install --upgrade pip setuptools wheel &amp;&amp; \
    python -m pip --no-cache-dir install --quiet scikit-learn

# Create user "docker"
RUN useradd -m docker &amp;&amp; \
    cp /root/.bashrc /home/docker/ &amp;&amp; \
    mkdir /home/docker/data &amp;&amp; \
    chown -R --from=root docker /home/docker

# Use C.UTF-8 locale to avoid issues with ASCII encoding
ENV LC_ALL=C.UTF-8
ENV LANG=C.UTF-8

ENV HOME /home/docker
WORKDIR ${BASE_IMAGE}/data
USER docker
</code></pre></div></div>

<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build -f Dockerfile.arg-py3 --build-arg BASE_IMAGE=python:3.8 -t arg-example:latest .
</code></pre></div></div>

<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run --rm -ti arg-example:latest /bin/bash
echo $HOME
echo $LC_ALL
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/home/docker

C.UTF-8
</code></pre></div></div>

<p>whereas for</p>

<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run --rm -ti arg-example:py-38 /bin/bash
echo $HOME
echo $LC_ALL
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/home/docker


</code></pre></div></div>

<h2 id="tags">Tags</h2>

<p>In the examples so far the built image has been tagged with a single tag (e.g. <code class="language-plaintext highlighter-rouge">latest</code>).
However, tags are simply arbitrary labels meant to help identify images and images can
have multiple tags.
New tags can be specified in the <code class="language-plaintext highlighter-rouge">docker build</code> command by giving the <code class="language-plaintext highlighter-rouge">-t</code> flag multiple
times or they can be specified after an image is built by using
<a href="https://docs.docker.com/engine/reference/commandline/tag/"><code class="language-plaintext highlighter-rouge">docker tag</code></a>.</p>

<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker tag &lt;SOURCE_IMAGE[:TAG]&gt; &lt;TARGET_IMAGE[:TAG]&gt;
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="add-your-own-tag">Add your own tag</h2>

  <p>Using <code class="language-plaintext highlighter-rouge">docker tag</code> add a new tag to the image you built.</p>

  <blockquote class="solution">
    <h2 id="solution">Solution</h2>

    <div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker images extend-example
docker tag extend-example:latest extend-example:my-tag
docker images extend-example
</code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>REPOSITORY          TAG                 IMAGE ID            CREATED            SIZE
extend-example      latest              b571a34f63b9        t seconds ago      1.59GB

REPOSITORY          TAG                 IMAGE ID            CREATED            SIZE
extend-example      latest              b571a34f63b9        t seconds ago      1.59GB
extend-example      my-tag              b571a34f63b9        t seconds ago      1.59GB
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<blockquote class="callout">
  <h2 id="tags-are-labels">Tags are labels</h2>

  <p>Note how the image ID didn’t change for the two tags: they are the same object.
Tags are simply convenient human readable labels.</p>
</blockquote>

<h2 id="copy"><code class="language-plaintext highlighter-rouge">COPY</code></h2>

<p>Docker also gives you the ability to copy external files into a Docker image during the
build with the <a href="https://docs.docker.com/engine/reference/builder/#copy"><code class="language-plaintext highlighter-rouge">COPY</code></a> Dockerfile command.
Which allows copying a target file on the from a host file system into the Docker image
file system</p>

<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code>COPY &lt;path on host&gt; &lt;path in Docker image&gt;
</code></pre></div></div>

<p>For example, if there is a file called <code class="language-plaintext highlighter-rouge">requirements.txt</code> in the same directory as
the build is executed from</p>

<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code>touch requirements.txt
</code></pre></div></div>

<p>with contents</p>

<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat requirements.txt
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scikit-learn==1.0
</code></pre></div></div>

<p>then this could be copied into the Docker image of the previous example during the build
and then used (and then removed as it is no longer needed) with the following</p>

<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Dockerfile.arg-py3
# Make the base image configurable
ARG BASE_IMAGE=python:3.9-bullseye
FROM ${BASE_IMAGE}

USER root

RUN apt-get -qq -y update &amp;&amp; \
    apt-get -qq -y upgrade &amp;&amp; \
    apt-get -y autoclean &amp;&amp; \
    apt-get -y autoremove &amp;&amp; \
    rm -rf /var/lib/apt/lists/*

COPY requirements.txt requirements.txt

RUN python -m pip --no-cache-dir install --upgrade pip setuptools wheel &amp;&amp; \
    python -m pip --no-cache-dir install --requirement requirements.txt &amp;&amp; \
    rm requirements.txt

# Create user "docker"
RUN useradd -m docker &amp;&amp; \
    cp /root/.bashrc /home/docker/ &amp;&amp; \
    mkdir /home/docker/data &amp;&amp; \
    chown -R --from=root docker /home/docker

# Use C.UTF-8 locale to avoid issues with ASCII encoding
ENV LC_ALL=C.UTF-8
ENV LANG=C.UTF-8

ENV HOME /home/docker
WORKDIR ${BASE_IMAGE}/data
USER docker
</code></pre></div></div>

<div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build -f Dockerfile.arg-py3 --build-arg BASE_IMAGE=python:3.8 -t arg-example:latest .
</code></pre></div></div>

<p>For very complex scripts or files that are on some remote, <code class="language-plaintext highlighter-rouge">COPY</code> offers a straightforward
way to bring them into the Docker build.</p>

<blockquote class="challenge">
  <h2 id="using-copy">Using <code class="language-plaintext highlighter-rouge">COPY</code></h2>

  <p>Write a Bash script that installs the <code class="language-plaintext highlighter-rouge">tree</code> utility and then use <code class="language-plaintext highlighter-rouge">COPY</code> to add it to
your Dockerfile and then run it during the build</p>

  <blockquote class="solution">
    <h2 id="solution-1">Solution</h2>

    <div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code>touch install_tree.sh
</code></pre></div>    </div>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#install_tree.sh</span>
<span class="c">#!/usr/bin/env bash</span>

<span class="nb">set</span> <span class="nt">-e</span>

apt-get update <span class="nt">-y</span>
apt-get <span class="nb">install</span> <span class="nt">-y</span> tree
</code></pre></div>    </div>

    <div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Dockerfile.arg-py3
# Make the base image configurable
ARG BASE_IMAGE=python:3.9-bullseye
FROM ${BASE_IMAGE}

USER root

RUN apt-get -qq -y update &amp;&amp; \
    apt-get -qq -y upgrade &amp;&amp; \
    apt-get -y autoclean &amp;&amp; \
    apt-get -y autoremove &amp;&amp; \
    rm -rf /var/lib/apt/lists/*

COPY requirements.txt requirements.txt

RUN python -m pip --no-cache-dir install --upgrade pip setuptools wheel &amp;&amp; \
    python -m pip --no-cache-dir install --requirement requirements.txt &amp;&amp; \
    rm requirements.txt

COPY install_tree.sh install_tree.sh
RUN bash install_tree.sh &amp;&amp; \
    rm install_tree.sh

# Create user "docker"
RUN useradd -m docker &amp;&amp; \
    cp /root/.bashrc /home/docker/ &amp;&amp; \
    mkdir /home/docker/data &amp;&amp; \
    chown -R --from=root docker /home/docker

# Use C.UTF-8 locale to avoid issues with ASCII encoding
ENV LC_ALL=C.UTF-8
ENV LANG=C.UTF-8

ENV HOME /home/docker
WORKDIR ${BASE_IMAGE}/data
USER docker
</code></pre></div>    </div>

    <div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build -f Dockerfile.arg-py3 --build-arg BASE_IMAGE=python:3.8 -t arg-example:latest .
</code></pre></div>    </div>

    <div class="language-plaintext source highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run --rm -ti arg-example:latest /bin/bash
cd
which tree
tree
</code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/usr/bin/tree

.
└── data

1 directory, 0 files
</code></pre></div>    </div>
  </blockquote>
</blockquote>






<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Dockerfiles are written as text file commands to the Docker engine</p>
</li>
    
    <li><p>Docker images are built with <code class="language-plaintext highlighter-rouge">docker build</code></p>
</li>
    
    <li><p>Built time variables can be defined with <code class="language-plaintext highlighter-rouge">ARG</code> and set with <code class="language-plaintext highlighter-rouge">--build-arg</code></p>
</li>
    
    <li><p><code class="language-plaintext highlighter-rouge">ENV</code> arguments persist into the container runtime</p>
</li>
    
    <li><p>Docker images can have multiple tags associated to them</p>
</li>
    
    <li><p>Docker images can use <code class="language-plaintext highlighter-rouge">COPY</code> to copy files into them during build</p>
</li>
    
  </ul>
</blockquote>

</article>



























  
  











<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../04-file-io/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../06-removal/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>


      
      






<footer>
  <div class="row">
    <div class="col-md-6 license" id="license-info" align="left">
	
	Licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a> 2018–2021
	by <a href="https://carpentries.org/">The Carpentries</a>
        <br>
        Licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a> 2016–2018
	by <a href="https://software-carpentry.org">Software Carpentry Foundation</a>
	
    </div>
    <div class="col-md-6 help-links" align="right">
	
	<a href="/edit//_episodes/05-dockerfiles.md" data-checker-ignore>Edit on GitHub</a>
	
	/
	<a href="/blob//CONTRIBUTING.md" data-checker-ignore>Contributing</a>
	/
	<a href="/">Source</a>
	/
	<a href="/blob//CITATION" data-checker-ignore>Cite</a>
	/
	<a href="mailto:matthew.feickert@cern.ch">Contact</a>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12" align="center">
      Using <a href="https://github.com/carpentries/styles/">The Carpentries style</a>
      version <a href="https://github.com/carpentries/styles/releases/tag/v9.5.3">9.5.3</a>.
    </div>
  </div>
</footer>

      
    </div>
    
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
